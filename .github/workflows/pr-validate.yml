# https://github.com/marketplace/actions/ftp-deploy
---
on: pull_request

env:
  RSYNC_PASSWORD: ${{ secrets.SFTP_PASSWORD }}

name: Test Publishing via SSH  # DOES NOT DEPLOY CHANGES!
jobs:
  web-deploy:
    name: Deploy Website During PR
    runs-on: ubuntu-latest
    steps:
      - name: Get Latest Code
        uses: actions/checkout@v3

      - name: Check file contents pre-edit
        run: ls -la && echo $RSYNC_PASSWORD

      - name: Run a one-line command
        run: mkdir ~/.ssh && echo -e "Host *\n    HostKeyAlgorithms +ssh-rsa\n    PubkeyAcceptedAlgorithms +ssh-rsa" > ~/.ssh/config

      - name: Check file contents post-edit
        run: ls -la ~/.ssh && cat ~/.ssh/config

      - name: Sync Files
        uses: SamKirkland/web-deploy@v1
        with:
          target-server: server234.web-hosting.com
          remote-user: davivirc
          private-ssh-key: ${{ secrets.WEBSITE_SSH_PRIVATE_KEY }}
          ssh-port: 21098
          destination-path: ~/public_html
          rsync-options: --dry-run --archive --compress --delete-after --human-readable --exclude=.git* --exclude=.git/
